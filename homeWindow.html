<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" type="text/css" href="Bootstrap/css/bootstrap.min.css">
    <script src="Bootstrap/js/bootstrap.min.js"></script>	
	<script src="CanvasJS/canvasjs.min.js"></script>	
    <script src="JustGauge/raphael-2.1.4.min.js"></script>
    <script src="JustGauge/justgage.js"></script>
	<script src="Plot.ly/plotly-latest.min.js"></script>

    <meta charset="utf-8" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Formula Electric</title>

	<script>
        const electron = require('electron');
        const {
            ipcRenderer
        } = electron;
    </script>
	
    <script>
        window.onload = function() {

            var dps = []; // data variable 1
            var dps2 = []; // data variable 2
            var dps3 = []; // data variable 3
            var dps4 = []; // data variable 4
            var dps5 = []; // data variable 5
			//Creating the multi part chart
            var chart = new CanvasJS.Chart("chartContainer", {
				backgroundColor: '',
                zoomEnabled: true,
                title: {
                    text: "Data Chart"
                },
                axisY: {
                    includeZero: false
                },
                axisX: {
                    title: "Time (s)"
                },
                toolTip: {
                    shared: true
                },
                legend: {
                    cursor: "pointer",
                    verticalAlign: "bottom",
                    fontSize: 12,
                    fontColor: "Black",
                    itemclick: toggleDataSeries
                },
                data: [{
                    type: "line",
                    dataPoints: dps,
                    xValueType: "number",
                    showInLegend: true,
                    name: "Measurement A",
                }, {
                    visible: false,
                    type: "line",
                    dataPoints: dps2,
                    xValueType: "number",
                    showInLegend: true,
                    name: "Measurement B",
                }, {
                    visible: false,
                    type: "line",
                    dataPoints: dps3,
                    xValueType: "number",
                    showInLegend: true,
                    name: "Measurement C",
                }, {
                    visible: false,
                    type: "line",
                    dataPoints: dps4,
                    xValueType: "number",
                    showInLegend: true,
                    name: "Measurement D",
                }, {
                    visible: false,
                    type: "line",
                    dataPoints: dps5,
                    xValueType: "number",
                    showInLegend: true,
                    name: "Measurement E",
                }]
            });
				//function that toggles the visible lines
            function toggleDataSeries(e) {
                if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                    e.dataSeries.visible = false;
                } else {
                    e.dataSeries.visible = true;
                }
                chart.render();
            }

            var xVal = 0; //set an initial value in the x axis
            var yVal = 100; //set an initial value in the y axis
            var yVal2 = 110; //set an initial value in the y axis
            var yVal3 = 115; //set an initial value in the y axis
            var yVal4 = 101; //set an initial value in the y axis
            var yVal5 = 111; //set an initial value in the y axis
            var updateInterval = 1000; //time taken for each update
            var dataLength = 30; // number of dataPoints visible at any point

				//function that updtaes the current y values
            var updateChart = function(count) {
                count = count || 1;
                for (var j = 0; j < count; j++) {
                    yVal = yVal + Math.round(5 + Math.random() * (-5 - 5));
                    yVal2 = yVal2 + Math.round(5 + Math.random() * (-5 - 5));
                    yVal3 = yVal3 + Math.round(5 + Math.random() * (-5 - 5));
                    yVal4 = yVal4 + Math.round(5 + Math.random() * (-5 - 5));
                    yVal5 = yVal5 + Math.round(5 + Math.random() * (-5 - 5));
                    dps.push({
                        x: xVal,
                        y: yVal
                    });
                    dps2.push({
                        x: xVal,
                        y: yVal2
                    });
                    dps3.push({
                        x: xVal,
                        y: yVal3
                    });
                    dps4.push({
                        x: xVal,
                        y: yVal4
                    });
                    dps5.push({
                        x: xVal,
                        y: yVal5
                    });
                    xVal++;
                }
                if (dps.length > dataLength) {
                    dps.shift();
                    dps2.shift();
                    dps3.shift();
                    dps4.shift();
                    dps5.shift();
                }
                chart.render();
            };
			
			//creating the chart for battery voltage
            var chart2 = new CanvasJS.Chart("voltageChart", {
                backgroundColor: '',
                animationEnabled: true,
                theme: "dark1",				
				axisY: {
                    title: "Voltage (V)",
					titleFontColor: "black",
					titleFontSize: 13,
					labelFontColor: "black"
                },
				axisX: {
					labelFontColor: "black"
				},
				data: [{ 
					type: "column", 
					dataPoints: [
						{y: 30,label: "1"}, 
						{y: 29,label: "2"}, 
						{ y: 25, label: "3" }, 
						{ y: 32, label: "4" }, 
						{ y: 30, label: "5" }, 
						{ y: 12, label: "6" }, 
						{ y: 15, label: "7" }, 
						{ y: 17, label: "8" }, 
						{ y: 19, label: "9" }, 
						{ y: 22, label: "10" }, 
						{ y: 25, label: "11" }, 
						{ y: 24, label: "12" }, 
						{ y: 2, label: "13" }, 
						{ y: 40, label: "14" }, 
						{ y: 35, label: "15" }, 
						{ y: 12, label: "16" }, 
						{ y: 30, label: "17" }, 
						{ y: 23, label: "18" }, 
						{ y: 25, label: "19" }, 
						{ y: 15, label: "20" }, 
						{ y: 40, label: "21" }, 
						{ y: 35, label: "22" }, 
						{ y: 16, label: "23" }, 
						{ y: 32, label: "24" }, 
						{ y: 20, label: "25" }, 
						{ y: 27, label: "26" }, 
						{ y: 20, label: "27" }, 
						{ y: 35, label: "28" }, 
						{ y: 23, label: "29" }, 
						{ y: 12, label: "30" }, 
						{ y: 30, label: "31" }, 
						{ y: 29, label: "32" }, 
						{ y: 25, label: "33" }, 
						{ y: 32, label: "34" }, 
						{ y: 30, label: "35" }, 
						{ y: 12, label: "36" }, 
						{ y: 15, label: "37" }, 
						{ y: 17, label: "38" }, 
						{ y: 19, label: "39" }, 
						{ y: 22, label: "40" }, 
						{ y: 25, label: "41" }, 
						{ y: 24, label: "42" }, 
						{ y: 2, label: "43" }, 
						{ y: 40, label: "44" }, 
						{ y: 35, label: "45" }, 
						{ y: 12, label: "46" }, 
						{ y: 30, label: "47" }, 
						{ y: 23, label: "48" }, 
						{ y: 25, label: "49" }, 
						{ y: 15, label: "50" }, 
						{ y: 40, label: "51" }, 
						{ y: 35, label: "52" }, 
						{ y: 16, label: "53" }, 
						{ y: 32, label: "54" }, 
						{ y: 20, label: "55" }, 
						{ y: 27, label: "56" }, 
						{ y: 20, label: "57" }, 
						{ y: 35, label: "58" }, 
						{ y: 23, label: "59" }, 
						{ y: 12, label: "60" }, 
						{ y: 40, label: "61" }, 
						{ y: 35, label: "62" }, 
						{ y: 16, label: "63" }, 
						{ y: 32, label: "64" }, 
						{ y: 20, label: "65" }, 
						{ y: 27, label: "66" }, 
						{ y: 20, label: "67" }, 
						{ y: 35, label: "68" }, 
						{ y: 23, label: "69" }, 
						{ y: 12, label: "70" }, 
						{ y: 20, label: "71" }, 
						{ y: 27, label: "72" }] 
				}] 
			});
            chart2.render();
			
				//creating random values for the voltages
            var updateChart2 = function() {
                for (var i = 1; i <= 72; i++) {
                    chart2.options.data[0].dataPoints[i] = {
                        y: Math.floor(Math.random() * 30 + 1)
                    };
                }

                chart2.render();
            }
			//chart for battery power 
			var batteryChart = new CanvasJS.Chart("batteryFill", {
				backgroundColor: '',
                animationEnabled: true,
				axisX:{
					labelFontSize: 12
				},
				axisY: {
					labelFontSize: 12,
					suffix: "%",
					maximum: 100,
					minimum: 0
				},
				dataPointWidth: 85,
				data: [{
					type: "column",
					color: "#014D65",
					dataPoints: [
						{label: "Battery Charge", y: 3}
					]
				}]
			});
			batteryChart.render();
				//create random  battery power values
			var updatebatteryChart = function() {
				batteryChart.options.data[0].dataPoints[0] = {
					y: Math.floor(Math.random() * 40 + 1),
					label: "Battery Charge"
				};
				
                batteryChart.render();
            }
				//generate random 'RAW Data'
            function randomRawData(section, lines) {
                var text = "";
                var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

                document.getElementById(section).innerHTML = "";

                for (var j = 0; j < lines; j++) {
                    for (var i = 0; i < 13; i++)
                        text += possible.charAt(Math.floor(Math.random() * possible.length));
                    text += "<br>";
                }

                document.getElementById(section).innerHTML += text;
            }
				//generate random 'Error Data'
            function randomError(section, lines) {
                var text = "";
                var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

                document.getElementById(section).innerHTML = "";

                for (var j = 0; j < lines; j++) {
                    text += "ERROR: "
                    for (var i = 0; i < 7; i++)
                        text += possible.charAt(Math.floor(Math.random() * possible.length));
                    text += "!<br>";
                }

                document.getElementById(section).innerHTML += text;
            }
				//update interval
            updateChart(dataLength);
            setInterval(function() {
                updateChart();
                updateChart2();
				updatebatteryChart();
                randomRawData("raw", 15);
                randomError("errors", 13);
            }, updateInterval);
            
			
			var xValues = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U'];
			var yValues = ['O', 'N', 'M', 'L', 'K', 'J', 'I', 'H', 'G', 'F', 'E', 'D', 'C', 'B', 'A'];
			var zValues = [
			  [0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.20, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.75, 0.75, 0.75, 0.75, 0.75,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.00, 0.00, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 1.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.75, 0.75, 0.75, 0.75, 0.75,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.00, 0.00, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.75, 0.75, 0.75, 0.75, 0.75,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.00, 0.00, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.10, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.20, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.75, 0.75, 0.75, 0.75, 0.75,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.00, 0.00, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 1.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.75, 0.75, 0.75, 0.75, 0.75,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.00, 0.00, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75],
			  [0.00, 0.00, 0.00, 0.75, 0.00,0.00, 0.00, 0.75, 0.75, 0.00,0.00, 0.00, 0.75, 0.10, 0.75, 0.00,0.00, 0.00, 0.75, 0.00, 0.75]
			];

			var colorscaleValue = [
			  [0, '#0066ff'],
			  [1, '#ff0000']
			];

			var data = [{
			  x: xValues,
			  y: yValues,
			  z: zValues,
			  type: 'heatmap',
			  colorscale: colorscaleValue,
			  showscale: false
			}];

			var layout = {
			  annotations: [],
			   margin: {
				l: 25,
				r: 0,
				b: 0,
				t: 25,
				pad: 3
			  },
			  xaxis: {
				ticks: '',
				side: 'top'
			  },
			  yaxis: {
				ticks: '',
				ticksuffix: ' ',
				width: 700,
				height: 700,
				autosize: true
			  }
			};

			for ( var i = 0; i < yValues.length; i++ ) {
			  for ( var j = 0; j < xValues.length; j++ ) {
				var currentValue = zValues[i][j];
				if (currentValue != 0.0) {
				  var textColor = 'white';
				}else{
				  var textColor = 'black';
				}
				var result = {
				  xref: 'x1',
				  yref: 'y1',
				  x: xValues[j],
				  y: yValues[i],
				  text: zValues[i][j],
				  font: {
					family: 'Arial',
					size: 10,
					color: 'rgb(50, 171, 96)'
				  },
				  showarrow: false,
				  font: {
					color: textColor
				  }
				};
				layout.annotations.push(result);
			  }
			}

			Plotly.newPlot('heatMap', data, layout);
			

        }
    </script>



    <style type="text/css">
		h3 {
			color: black;
		}
        
        .row div {
            
            min-height: 10vh;
        }
		html 
		{
			box-sizing: border-box;
		}
		*, *:before, *:after 
		{
		  box-sizing: inherit;
		}
		body, html, .container-fluid {
			height: 100%;
		}
		hr {
			display: block;
			height: 1px;
			border: 0;
			border-top: 1px solid #ccc;
			margin: 1em 0;
			padding: 0; 
			border-color: black;
		}
	.IMU
	{
		position: relative;
		top: 0;
		left: 0;
	}
	.IMU_BALL
	{
		position: relative;
		top: 0px;
		left: -92px;
	}
    </style>
</head>

    
<body>
    <header>
        <img src="Images/logo_waterloo_formula_electric.png" alt="Formula ELectric Logo" width="250px">
		<div class="btn-group">
			<button type="button" class="btn btn-primary disabled">Test Mode</button>
			<button type="button" class="btn btn-primary ">Race Mode</button>
		</div>
    </header>
<div class="container-fluid full-width">
	<div class="row"> <!--row 1-->
		<div class="col-sm-1"><!--column 1 - 1 spot | raw data-->
			<div id="raw_data" style="border-style: none;">
				<h3>Raw data</h3>
				<p id="raw"></p>
			</div>
		</div>
		
		<div class="col-sm-5" style="border-style: none;"><!--column 2 - 5 spots | charts-->
			<div id="chartContainer" style="height: 40vh; border-style: none; margin: 0px -15px 0px -15px;">
			</div>		
		</div>
		
		<div class="col-sm-3"><!--column 3 - 3 spots | -->
			<div class="row" style="border-left-style: none;border-bottom-style: none;"><!-- tires-->
				<h3>Tires</h3>
			</div>
			
			<div class="row" style="border-left-style: none;border-bottom-style: none;"><!--steering-->
				<h3>Steering</h3>
				<img width="90" height="90" style="float: right" id="steering" src="images/steeringWheel.png" /> Rotation angle:
				<input name="rotateDeg" type="number" maxlength="4" id="rotateDeg" class="rotateField">
				<br>
				<button type="button" id="rotateButton">Rotate</button>
			</div>
			
			<div class="row" style="border-left-style: none;border-bottom-style: none;"><!-- IMU-->
				<h3>IMU</h3>
				<img width="150" height="150" class="IMU" id="IMU" src="images/IMU.png" />
				<img width="30" height="30" class="IMU_BALL" id="Ball" src="images/Ball.png" /> 
			</div>
		</div>
		
		<div class="col-sm-3"><!--column 4 - 3 spots | -->
			<div class="row" style="border-left-style: none;border-bottom-style: none;"> <!-- suspension-->
				<h3>Suspension</h3>
				<table border="2">
					<th>Left Wheels</th>
					<th>Right Wheels</th>
					<tr>
						<td id="FL">0</td>
						<td id="FR">0</td>
					</tr>
					<tr>
						<td id="RL">0</td>
						<td id="RR">0</td>
					</tr>
				</table>
			</div>
			
			<div class="row" style="border-left-style: none;border-bottom-style: none;"> <!--brakes-->
				<h3>Brakes</h3>
			</div>
			
			<div class="row"style="border-left-style: none;border-bottom-style: none;"> <!--trhottle-->
				<h3>Throttle</h3>
			</div>
		</div>
	</div>
	
	<hr>
	<div class="row" style="height:45%; display: block;"><!--row 2-->
		<div class="col-sm-1"><!--column 1 - 1 spot | errors-->
			<div id="error" style="border-style: none">
				<h3>Errors</h3>
				<p id="errors"></p>
			</div>		
		</div>
		
		<div class="col-sm-5"><!--column 2 - 5 spots-->
			<div class="row"> 
				<div class="col-sm-5" style="border-style: none"><!--column 1 - 4 spots | Motor speed-->
					<div id="gauge" style="height:200px;border-style:none"></div>	
				</div>
				
				<div class="col-sm-2" style="border-left-style: none;border-bottom-style: none;"><!--column 2 - 4 spots | battery-->
					<div id="batteryFill" style="height: 25vh; border-style: none; margin: 0px -15px 0px -15px;">
                    </div>
				</div>
				
				<div class="col-sm-5" style="border-left-style: none;border-bottom-style: none;"><!--column 3 - 4 spots | damper-->
					<h3>Damper</h3>
				</div>
			</div>
			
			<div class="row"style="border-style: none; height:20vh;border-style: none;"><!--voltage-->
				<h3>Accumulator Voltage</h3>
				<div id="voltageChart" style="height: 100%; width: 100%;border-style: none"></div>
			</div>
		</div>

		<div class="col-sm-6"><!--column 1 - 6 spots | heat map-->
			<h3>Accumulator Temperature</h3>
			<div id="heatMap" style="height: 40vh; width: 100%;border-style: none"></div>
		</div>		
	</div>
</div>
</body>
<script>
    var g = new JustGage({
        id: "gauge",
        value: getRandomInt(0, 100),
        counter: true,
        min: 0,
        max: 100,
        title: "Speed",
        titleFontColor: "black",
        label: "KM/H",
        levelColors: [
            "#6eff6c",
            "#03ad00",
            "#00ad93"
        ]
    });
    setInterval(function() {
        g.refresh(getRandomInt(0, 100));
    }, 500);
</script>
<script>
    // STEERING FUNCTIONALITY
    document.getElementById("rotateButton").onmousedown = function(event) {
        var deg = document.getElementById('rotateDeg').value;
        document.getElementById("steering").style.WebkitTransform = "rotate(" + deg + "deg)";
    }
    
    // IMU FUNCTIONALITY
   function imuMove() {
    if (Math.random()<0.5)
        var transX =  (-1)*Math.floor(Math.random() * 6.2);
    else
    	var transX =  Math.floor(Math.random() * 6.2);
    if (Math.random()<0.5)
        var transY =  (-1)*Math.floor(Math.random() * 6.2);
    else
    	var transY =  Math.floor(Math.random() * 6.2);
        document.getElementById("Ball").style.WebkitTransform = "translate(" + 28*Math.cos(transX) + "px, "+ 28*Math.cos(transY)+"px)";
    }
    
    setInterval(function() {
    	imuMove()
    }, 100);

    // RAW DATA FUNCTIONALITY
    var rawData = function(count) {
        //document.getElementById("raw").innerHTML = document.getElementById("raw").innerHTML + Math.random();
        var symbol = Math.floor(Math.random() * 8 + 1);
    }
</script>

</html>